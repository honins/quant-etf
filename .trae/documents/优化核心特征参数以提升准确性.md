# 优化核心特征参数以提升预测准确性

为了提高模型的**预测准确性**（而非运行速度），我们需要解决现有特征中的“非平稳性”问题。目前的特征包含大量绝对价格（如 `ma5`, `ma20`）和累积值（如 `obv`），这些值会随着时间推移和股价涨跌而发生剧烈变化，导致模型难以学习到通用的规律（例如：2020年的3000点和2026年的3000点含义完全不同）。

我们将通过**归一化（Normalization）**处理，将绝对值转换为相对值，帮助模型捕捉更本质的市场规律。

## 1. 特征工程升级 (`src/features/technical.py`)

我们将计算以下“相对特征”来替代旧的“绝对特征”：

*   **均线 -> 乖离率 (Bias)**:
    *   旧: `ma5`, `ma20`, `ma60` (绝对价格)
    *   新: `bias_5`, `bias_20`, `bias_60`
    *   公式: `(收盘价 - 均线) / 均线`
    *   *意义*: 衡量价格偏离趋势的程度，模型更容易学习“偏离过多回归”的规律。

*   **MACD -> 标准化 MACD**:
    *   旧: `macd`, `macdsignal`, `macdhist`
    *   新: `macd_norm`, `macdsignal_norm`, `macdhist_norm`
    *   公式: `原值 / 收盘价`
    *   *意义*: 消除股价高低对指标数值大小的影响。

*   **ATR -> 波动率占比**:
    *   旧: `atr`
    *   新: `atr_pct`
    *   公式: `atr / 收盘价`
    *   *意义*: 衡量相对波动幅度（例如 1% 的波动），而非绝对金额。

*   **OBV -> 量比**:
    *   旧: `obv` (累积值，甚至可能为负，不仅非平稳且无界)
    *   新: `vol_ratio` (量比)
    *   公式: `成交量 / 5日均量`
    *   *意义*: 捕捉放量/缩量信号，比累积的 OBV 更直接有效。

*   **布林带 -> 布林位置**:
    *   旧: `upper`, `lower`
    *   新: `bb_pos` (布林带相对位置)
    *   公式: `(收盘价 - lower) / (upper - lower)`
    *   *意义*: 0 代表在下轨，1 代表在上轨，0.5 在中轨。

## 2. 模型配置更新 (`src/models/xgb_model.py`)

*   更新 `feature_cols` 列表，移除旧的绝对值特征，启用上述新的相对值特征。

## 3. 执行与验证

1.  修改代码实现上述特征计算。
2.  **重要**: 由于特征定义发生了根本性变化，旧的模型文件 (`data/xgb_model.json`) 将不再可用。
3.  我们需要运行 `python train_and_backtest.py` 重新训练模型。
