# AI 驱动的 ETF 量化交易系统 (Quant-ETF)

[![AI Powered](https://img.shields.io/badge/AI-XGBoost-blue)](src/models/xgb_model.py)
[![Strategy](https://img.shields.io/badge/Strategy-Hybrid-green)](STRATEGIES.md)
[![License](https://img.shields.io/badge/license-MIT-gray)]()

这是一个**务实的、AI 驱动的波段交易辅助系统**。

它不仅仅是一个简单的指标计算器，而是一个集成了 **XGBoost 机器学习** 和 **传统规则风控** 的混合决策系统。它旨在帮助普通交易者在 A 股 ETF 市场中寻找高胜率的买点，并严格控制回撤。

---

## 🚀 核心亮点

- **🧠 AI 进化 (XGBoost)**: 抛弃死板的指标规则，使用竞赛级算法 **XGBoost** 从历史数据中自动挖掘非线性 Alpha。
- **🛡️ 混合策略 (Hybrid Strategy)**:
  - **进攻**: 由 AI 负责，敏锐捕捉量价时空的共振机会。
  - **防守**: 由规则负责，大盘熊市强制空仓，个股亏损强制止损。
- **🎒 持仓管家**: 自动跟踪您的持仓，支持**分批加仓**管理，自动计算加权成本和持仓天数。每日计算**移动止盈位 (Trailing Stop)**，告诉您何时该止盈离场，锁住利润。
- **📝 智能点评**: 内置技术面解释器，将冷冰冰的指标翻译成“均线多头”、“超买风险”等通俗人话。
- **📱 飞书/邮件通知**: 支持自动推送精美日报到您的飞书群或邮箱，不错过任何信号。
- **⚡ 极速响应**: 纯 Python (Pandas) 实现，无需安装复杂的 TA-Lib，开箱即用。

---

## 📚 文档导航

- [**STRATEGIES.md**](STRATEGIES.md): 深度解析为什么选择 XGBoost？为什么放弃贝叶斯？混合策略是如何工作的？
- [**ALGORITHM_DETAILS.md**](ALGORITHM_DETAILS.md): 系统的“白皮书”。详细列出了 12 个核心特征的计算公式和 AI 模型的训练细节。

---

## 🎬 理想工作流 (Daily Workflow)

本系统旨在成为您的**“智能副驾驶”**。推荐的日常使用流程：

### 🕒 1. 收盘后 (15:10)

运行程序生成日报。

```bash
python main.py
```

您会看到类似这样的分析：

> **[卫星ETF]**
>
> - 🤖 **AI 评分**: **0.64** (高分信号!)
> - 📝 **点评**: 均线多头排列，但 RSI 进入超买区。
> - 💡 **决策**: **买入**
> - 🛡️ **风控**: 止损位 **2.01** (ATR=0.08)

### 🕒 2. 盘前 (次日 09:25)

根据昨晚的计划，挂单买入。同时设置条件单（止损单）。

### 🕒 3. 持仓期

每天运行程序，关注 **移动止盈位** 的更新。

- 如果价格上涨，止盈位会自动上移，锁定利润。
- 如果价格跌破止盈位，坚决离场。

---

## 🛠️ 安装与使用

### 1. 环境准备

```bash
# 创建虚拟环境
python -m venv venv

# 激活环境 (Windows)
venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置 Token

1.  复制 `.env.example` 为 `.env`
2.  填入您的 Tushare Token (注册获取: [https://tushare.pro/](https://tushare.pro/))

### 3. 配置持仓 (可选)

在 `config/holdings.yml` 中配置您的持仓信息，支持分批买入记录：

```yaml
holdings:
  - code: 515070.SH
    name: 人工智能ETF
    transactions:
      - date: "20260109"
        price: 2.02
        shares: 5000
      - date: "20260115"
        price: 2.10
        shares: 5000
```

### 4. 训练 AI 模型 (可选)

系统已内置了预训练好的模型。如果您想使用最新数据重新训练或验证近期表现：

```bash
# 重新训练模型
python train_and_backtest.py

# 验证最近 3 个月表现
python backtest_3m.py
```

### 6. 开启自动通知 (可选)

想要每天早上收到日报推送？

1.  **配置飞书**: 在飞书群添加“自定义机器人”，将 Webhook 地址填入 `.env`。
2.  **启动定时任务**:
    ```bash
    python scheduler.py
    ```
    _程序将在每天 09:00 和 17:00 自动运行。_

### 7. 服务器部署 (推荐)

如果您希望 7x24 小时无人值守运行，可以使用我们提供的 Docker 方案一键部署到云服务器。

👉 **[查看详细部署指南 (DEPLOY.md)](DEPLOY.md)**

---

## 📊 策略表现 (2025.10 - 2026.01)

### 1. 实盘模拟回测

基于最近 3 个月的实盘模拟回测（运行 `python backtest_3m.py` 查看详情）：

| 标的          | 收益率      | 交易次数 | 胜率  | 评价            |
| :------------ | :---------- | :------- | :---- | :-------------- |
| **卫星ETF**   | **+11.99%** | 1        | 100%  | 🚀 准确捕捉趋势 |
| **科创50ETF** | **+11.19%** | 3        | 100%  | 📈 科技成长龙头 |
| **半导体ETF** | **+10.60%** | 2        | -     | 🔌 行业复苏红利 |
| **黄金ETF**   | **+7.41%**  | 3        | 66.7% | 💰 避险资产配置 |
| **军工ETF**   | **+5.94%**  | 3        | 100%  | 🛡️ 政策驱动上涨 |

#### 2025 Q4 压力测试 (熊市/震荡市)

**测试时间**: 2025-10-01 至 2025-12-31
**市场环境**: 多数宽基指数下跌，市场情绪低迷。

| 标的                   | 收益率      | 交易次数 | 胜率  | 评价                        |
| :--------------------- | :---------- | :------- | :---- | :-------------------------- |
| **半导体ETF (159206)** | **+11.51%** | 2        | 100%  | 🏆 逆势大涨，精准捕捉主升浪 |
| **新能源车ETF**        | **+6.93%**  | 1        | 100%  | ⚡ 唯一出手即获利           |
| **信息技术ETF**        | **+3.14%**  | 3        | 66.7% | 💻 科技板块抗跌             |
| **科创100ETF**         | **+1.91%**  | 5        | 40%   | 🛡️ 震荡中勉强盈利           |
| **AI智能ETF**          | -8.25%      | 2        | 0%    | 📉 抄底失败 (止损生效)      |
| **创业板ETF**          | -7.21%      | 1        | 0%    | 📉 趋势下跌，及时止损       |

**💡 结论**: 在 Q4 的艰难磨底期，模型整体微亏 (-1.48%)，但大幅跑赢创业板 (-7%) 和科创50 (-5%)。证明了在震荡分化市中，模型能精准筛选出如半导体这样的强势品种，同时通过 ATR 风控避免了深套。

### 2. 模型信号质量评估

基于最近 6 个月（约 2000 个样本）的统计，模型对**未来 5 天最高涨幅 > 2%** 的预测能力如下：

| AI 评分         | 胜率 (涨幅>2%) | 平均最高涨幅 | 建议                   |
| :-------------- | :------------- | :----------- | :--------------------- |
| **> 0.70**      | **93.2%**      | **> 7.00%**  | 🔥 **强烈推荐 (重仓)** |
| **0.65 - 0.70** | **83.4%**      | **6.26%**    | 🟢 **推荐 (标准仓)**   |
| **0.60 - 0.65** | 74.3%          | 5.16%        | 🟡 谨慎参与            |
| **< 0.50**      | 50.5%          | 2.59%        | 🔴 观望                |

### 3. Alpha 验证 (大盘环境压力测试)

是不是只有牛市才能赚钱？我们测试了在不同大盘环境下的高分信号表现：

| 市场环境                  | 信号胜率  | 结论                                 |
| :------------------------ | :-------- | :----------------------------------- |
| **🐂 牛市** (Index > 1%)  | **96.4%** | 顺势而为，闭眼赚钱                   |
| **⚖️ 震荡** (Index ±1%)   | **77.5%** | **体现核心 Alpha**，大盘不动个股照涨 |
| **🐻 熊市** (Index < -1%) | 42.9%     | 覆巢无完卵，需依赖风控系统空仓       |

_注：以上数据基于 2026-01-28 的回测结果。历史业绩不代表未来表现，投资有风险，入市需谨慎。_

---

## ⚖️ 风险提示 (Disclaimer)

**本系统仅供技术研究和辅助参考，不构成任何投资建议。**

1.  **过拟合风险**: AI 模型基于历史数据训练，历史不代表未来。
2.  **市场风险**: 策略无法预测黑天鹅事件（如政策突变、战争）。
3.  **执行风险**: 实盘交易存在滑点、手续费及成交延迟，可能导致实际收益低于回测。
4.  **震荡市磨损**: 在长期横盘震荡市场中，趋势策略可能会连续止损，导致本金回撤。

**请务必严格遵守 ATR 止损规则，控制仓位，理性投资。**
